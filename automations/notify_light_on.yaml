  id: notify_light_alert
  alias: Light On Alert
  trigger:
    - platform: state
      entity_id: 'device_tracker.brittanys_pixel'
      to: 'not_home'
    - platform: state
      entity_id: 'device_tracker.calebs_pixel'
      to: 'not_home'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'device_tracker.brittanys_pixel'
        state: 'not_home'
      - condition: state
        entity_id: 'device_tracker.calebs_pixel'
        state: 'not_home'
      - condition: template
        value_template: >
          {% for state in states.light %}
            {{ state.state == 'on' and state.entity_id != 'light.hgrp0000000030' and state.entity_id != 'light.hue_living_room' and state.entity_id != 'light.hue_master_bedroom' and state.entity_id != 'light.movie_room' and state.entity_id != 'light.entry_table_lamp' }}
          {% endfor %}
  action:
    - service_template: "notify.home"
      data_template:
        title: '**Alert - Light On**'
        message: >
          {% for state in states.light %}
            {%- if (is_state(state.entity_id, 'on') and state.entity_id != 'light.hgrp0000000030' and state.entity_id != 'light.hue_living_room' and state.entity_id != 'light.hue_master_bedroom' and state.entity_id != 'light.movie_room' and state.entity_id != 'light.entry_table_lamp')  %}
              "No one is home and the {{ state_attr(state.entity_id, 'friendly_name') }} is still on."
            {% endif -%}
          {% endfor %}


    # platform: template
    # value_template: "{% if is_state('device_tracker.calebs_pixel', 'home')%}false{% endif %}"

    # - condition: template
    #   value_template: >
    #     {% for state in states.switch %}
    #       {%- if is_state(state.entity_id, 'on') %}
    #         true
    #       {% endif -%}
    #     {% endfor %}

      #
      # - condition: template
      #   value_template: >

      #
      # {% set ignore_lights = ['light.movie_room', 'light.entry_table_lamp', 'light.hue_master_bedroom','light.hgrp0000000030','light.hue_living_room' ] %}
      # {{ states.light | rejectattr('entity_id','in',ignore_lights) | selectattr('state','eq','on') | map(attribute='name') | list }}
